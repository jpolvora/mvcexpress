# mvcexpress
A Convention Over Configuration MVC Framework on top of Express for Node.js

**documentation outdated**

todo:
* model binding
* dependency injection
* suggestions will be appreciated

# install
```js
npm install --save jpolvora/mvcexpress
```

# enable
```js
var express = require('express')
var app = express()

/* app will use mvcexpress as middleware*/
const mvcoptions = {
    mountPath: '/mvc/'
}
const mvcexpress = require('mvcexpress')(app, mvcoptions)

mvcexpress.on('controllerCreated', (controllerInstance) => {
    console.log('controller was instantiated', controllerInstance)
})

```

# conventions

Controllers folder must be in root project: `{root}/controllers`

Routes defaults to `{mountPath}/{controllerName}/{actionName}/*` where `mountPath` is the path where the middleware was mounted in express. Defaults to /mvc/. You can change it in instantiation options.

The default controllerName is `home`.

The default actionName is `index`.

# Usage

Create a folder named `controllers` at root path of your express application. Then place your controllers inside this folder. Remember to use always lowercase names for the controllers.

This means that the framework will search for a module at `/controllers/home.js`.

The names of the actions can be derived by the request.method in camelCase:
```
POST /users/create
controller: users
action: create
method: POST

Will resolve to: 
controller: /controllers/users.js
possible action names: [postCreate, create, catchAll]
```

Here is an example of a controller:

`/controllers/home.js`

```js
module.exports = function () {
    return {
        index: function()  {
           return this.view("index", { title: "express..." })
        },
        about: () => {
            /* returning a string that will be rendered by res.send 
                you can use your custom template engine
            */
            return "I'm about page."
        },
        catchAll: () => {
            // "When an action is not found, the catchAll enters in action."
            return this.redirect('/home/index')
        }
    }
}
```

You can use es6 class syntax:
```js
module.exports = class {

    index() {
        return this.view('index', {title: "hello world!"})
    }

    //GET /home/contact
    getContact() {
        return this.view('contactForm', { title: 'contact'})
    }

    //POST /home/contact
    postContact() {
        let self = this;
        return dataService.save(self.req.body).then(() => {
            self.redirect('/home/success')
        })
    }
}
```

# Demo application
Clone this repo, go to folder /demo and run `npm install`.

This demo is an application generated by express generator with jade template engine.

### Adding more controllers

Just create a new module inside `controllers` folder, for example: 
`/controllers/users.js`
```js
//this controller doesn't return a function, so nothing will be injected.
//In order to use services injection, use the function(services) {} format
module.exports = {
    //users/index
    index: function() {
        return "Welcome to /users/index route."
    },
    //GET users/create
    getCreate: function() {
            return (res) => {
                res.render('myview', {})
            }
    },
    postCreate: async function(req) {
        let form = req.body;
        await fakeDataService.saveUser(form);

        return (res) => {
            res.status(201); //created
        }
    }
}
```
