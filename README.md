# mvcexpress
A Convention Over Configuration MVC Framework on top of Express for Node.js

# install
```js
npm install --save jpolvora/mvcexpress
```

# enable
```js
var express = require('express')
var app = express()

const mvcexpress = require('mvcexpress')
/* insert before your routes */
const { registerMvc } = mvcexpress()
const mvc = registerMvc();
mvc.on('controllerCreated', function() {
    console.log('some controller was created', arguments)
})
app.use(mvc.router);
```

# conventions

Controllers folder must be in root project: `{root}/controllers`

Routes defaults to `{mountPath}/{controllerName}/{actionName}` where `mountPath` is the path where the middleware was mounted in express.

The default controllerName is `home`.

The default actionName is `index`.

# Usage

Create a folder named `controllers` at root path of your express application. Then place your controllers inside this folder. Remember to use always lowercase names for the controllers.

This means that the framework will search for a module at `/controllers/home.js`.

The names of the actions can be derived by the request.method in camelCase:
```
POST /users/create
controller: users
action: create
method: POST

Will resolve to: 
controller: /controllers/users.js
possible action names: [postCreate, create, catchAll]
```

Here is an example of a controller:

`/controllers/home.js`

```js
module.exports = function ( { view, redirect, json, content, raw  } ) {
    return {
        index: (req) => {
           return view("index", { title: "express..." })
        },
        about: (req) => {
            /* returning a string that will be rendered by res.send */
            return "I'm about page."
        },
        catchAll: (req) => {
            return function (res) {
                res.send("When an action is not found, the catchAll enters in action.");
            }
        }
    }
}
```

You can use es6 class syntax:
```js
module.exports = class {
    constructor(services) {
        this.view = services.view
        this.redirect = services.redirect
        this.dataService = require('dataService')
    }

    index(req) {
        return this.view('index', {title: "hello world!"})
    }

    //GET /home/contact
    getContact(req) {
        return this.view('contactForm', { title: 'contact'})
    }

    //POST /home/contact
    postContact(req) {
        let self = this;
        return dataService.save(req.body).then(() => {
            self.redirect('/home/success')
        })
    }
}
```

# Demo application
Clone this repo, go to folder /demo and run `npm install`.

This demo is an application generated by express generator with jade template engine.

### Adding more controllers

Just create a new module inside `controllers` folder, for example: 
`/controllers/users.js`
```js
//this controller doesn't return a function, so nothing will be injected.
//In order to use services injection, use the function(services) {} format
module.exports = {
    //users/index
    index: function(req) {
        return "Welcome to /users/index route."
    },
    //GET users/create
    getCreate: function(req) {
            return (res) => {
                res.render('myview', {})
            }
    },
    postCreate: async function(req) {
        let form = req.body;
        await fakeDataService.saveUser(form);

        return (res) => {
            res.status(201); //created
        }
    }
}
```
